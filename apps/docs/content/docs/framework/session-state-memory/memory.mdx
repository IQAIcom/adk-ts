---
title: Memory
description: Pluggable long-term memory for recalling past conversations
---

import { Card, Cards } from "fumadocs-ui/components/card";
import { Callout } from "fumadocs-ui/components/callout";

Memory turns past sessions into searchable knowledge. Where **Session** tracks the current thread and **State** holds working data, **Memory** persists what matters across days or devices.

## Architecture

- **MemoryService** orchestrates storage, summarization, and embeddings. (`packages/adk/src/memory/memory-service.ts`)
- **Storage Provider** decides how memories are persisted and searched.
- **Summary Provider** turns a session into structured memory content.
- **Embedding Provider** enables semantic search (optional).

```typescript
import {
  MemoryService,
  InMemoryStorageProvider,
  LlmSummaryProvider,
  OpenAIEmbeddingProvider,
  VectorStorageProvider,
  FileVectorStore,
} from "@iqai/adk";

// Development: keyword search, no vectors
const devMemory = new MemoryService({
  storage: new InMemoryStorageProvider(),
});

// Production: vector search with summaries + embeddings
const prodMemory = new MemoryService({
  storage: new VectorStorageProvider({
    vectorStore: new FileVectorStore({
      basePath: "./data/memories",
      writeSummaries: true,
      format: "json",
    }),
    searchMode: "vector",
  }),
  summaryProvider: new LlmSummaryProvider({ model: "gpt-4o-mini" }),
  embeddingProvider: new OpenAIEmbeddingProvider({
    model: "text-embedding-3-small",
  }),
});
```

## Storage Providers

- `InMemoryStorageProvider` – keyword search, fastest for local dev.
- `FileStorageProvider` – keyword search persisted to disk (`json` or `markdown`).
- `VectorStorageProvider` – uses a vector store adapter; supports `vector`, `keyword`, or `hybrid` search modes.
  - Vector store adapters: `InMemoryVectorStore` (dev), `FileVectorStore` (persisted), `QdrantVectorStore` (production database).

<Callout type="info">
  Vector search requires an embedding provider. `QdrantVectorStore` needs the
  `@qdrant/js-client-rest` dependency and a configured collection (supply
  `dimensions` to auto-create).
</Callout>

## Summary Providers

- `LlmSummaryProvider` – LLM-generated summary, topic segments, entities, key facts. Configurable model and prompt.
- `PassthroughSummaryProvider` – stores raw conversation text without calling an LLM.

If you omit `summaryProvider`, MemoryService stores minimal raw text from the session.

## Embedding Providers

Optional; required for vector search.

- `OpenAIEmbeddingProvider`
- `CohereEmbeddingProvider`
- `OllamaEmbeddingProvider`
- `OpenRouterEmbeddingProvider`

## Attach Memory to an Agent

```typescript
import {
  AgentBuilder,
  InMemorySessionService,
  RecallMemoryTool,
  MemoryService,
  InMemoryStorageProvider,
} from "@iqai/adk";

const sessionService = new InMemorySessionService();
const memoryService = new MemoryService({
  storage: new InMemoryStorageProvider(),
});

const { runner } = await AgentBuilder.withModel("gemini-2.5-flash")
  .withInstruction("Use recall_memory to answer from prior chats.")
  .withTools(new RecallMemoryTool())
  .withSessionService(sessionService, { userId: "alice", appName: "demo" })
  .withMemory(memoryService)
  .build();
```

## Storing Sessions

Memory is not saved automatically; call `addSessionToMemory` when you decide a session is worth keeping.

```typescript
const session = await sessionService.getSession("demo", "alice", sessionId);
if (session) {
  await memoryService.addSessionToMemory(session);
}
```

## Searching Memory

```typescript
const results = await memoryService.search({
  userId: "alice",
  appName: "demo",
  query: "favorite programming language",
  filters: { after: "2026-01-01T00:00:00.000Z" },
  limit: 5,
});
```

With embeddings configured, MemoryService will embed the query and pass it to the storage provider for semantic search.

## Memory Tools

- `RecallMemoryTool` / `LoadMemoryTool` / `PreloadMemoryTool` – search and load memories for the current user.
- `WriteMemoryTool` – explicitly write a fact to memory.
- `ForgetMemoryTool` – delete memories by ID or query.
- `GetSessionDetailsTool` – fetch full session content for a memory hit.

These tools use the configured `memoryService` and require `withMemory(...)` in your agent setup.

## What Gets Stored

Stored: user messages, agent responses, tool outputs with text, timestamps, and structured summary fields (summary, segments, keyFacts, entities) when a summary provider is used.

Not stored: empty events or binary data (use [Artifacts](/docs/framework/artifacts) for files/blobs).

## Migration Notes

- `InMemoryMemoryService` is deprecated; use `MemoryService` with `InMemoryStorageProvider`.
- `VertexAiRagMemoryService` has been removed; use `MemoryService` plus `VectorStorageProvider` with your vector DB (e.g., Qdrant) or `FileVectorStore` for persistent local vectors.

## Next Steps

<Cards>
  <Card
    title="Session"
    description="Manage conversation threads"
    href="/docs/framework/session-state-memory/session"
  />
  <Card
    title="State"
    description="Store conversation data"
    href="/docs/framework/session-state-memory/state"
  />
  <Card
    title="Tools"
    description="Build custom memory tools"
    href="/docs/framework/tools"
  />
  <Card
    title="Vertex AI"
    description="Scale sessions in the cloud"
    href="/docs/framework/session-state-memory/vertex-ai"
  />
</Cards>
