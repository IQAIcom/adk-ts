# Interface Discrepancy Report: Python to TypeScript Port

This document summarizes the differences found between Python interfaces/classes in the `adk-python` project and their counterparts in the `adk-ts` (TypeScript) project. The goal is to identify areas for refactoring to ensure faithful porting of logic and structure.

| TypeScript File Path             | Python Counterpart Path            | Interface/Class Name | Key Existing Methods/Properties (TS)                                                                 | Missing in TS (from Python)                                                                                                                                                                                                                                                                                                                                                                                    | Additional in TS (Not in Python)                                                                                                                                                           | Impact on Refactoring (TS) | Notes/Key Differences                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| :------------------------------- | :--------------------------------- | :------------------- | :--------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `src/agents/base-agent.ts`       | `adk-python/agents/base_agent.py`  | `BaseAgent`          | `name`, `description`, `parentAgent?`, `subAgents`, `constructor`, `rootAgent`, `addSubAgent`, `findSubAgent`, `findAgent`, `abstract run`, `abstract runStreaming` | `model_config` (Pydantic), `before_agent_callback`, `after_agent_callback` (and related types/methods), `run_async` (different signature, yields Events, uses `InvocationContext`), `_run_async_impl`, `run_live`, `_run_live_impl`, `_create_invocation_context`, field validators (Pydantic), `model_post_init`. Python's `run_async` takes `InvocationContext`. | `run(options: {messages, config, sessionId})`, `runStreaming(options:...)`. TS `run` methods return `Promise<any>` or `AsyncIterable<any>`.                                              | Major                      | TS version lacks the extensive callback system and Pydantic-specific features. `run` method signatures and context handling (`InvocationContext`) are significantly different. Python version is more feature-rich regarding lifecycle hooks and context.                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `src/tools/base/base-tool.ts`    | `adk-python/tools/base_tool.py`    | `BaseTool`           | `name`, `description`, `isLongRunning`, `shouldRetryOnFailure`, `maxRetryAttempts`, `baseRetryDelay`, `maxRetryDelay`, `constructor(ToolConfig)`, `abstract getDeclaration`, `validateArguments`, `abstract runAsync`, `safeExecute` | `process_llm_request` (for integrating with LlmRequest), `_api_variant` property. Python's `_get_declaration` returns `Optional[types.FunctionDeclaration]`. Python's `run_async` is a base method raising `NotImplementedError`.                                                                                                                                                           | Built-in retry logic properties and methods (`shouldRetryOnFailure`, `maxRetryAttempts`, `baseRetryDelay`, `maxRetryDelay`, `safeExecute`), `validateArguments` method. Constructor takes `ToolConfig`. `getDeclaration` returns local `FunctionDeclaration`. | Major                      | TS `BaseTool` has built-in client-side retry and argument validation (`safeExecute`). Python `BaseTool` includes `process_llm_request` for server-side/request modification logic, which TS lacks. Different sources for `FunctionDeclaration` type.                                                                                                                                                                                                                                                                                                                                                                                           |
| `src/tools/base/base-tool.ts`    | `adk-python/tools/base_tool.py`    | `ToolConfig` (TS)    | `name`, `description`, `isLongRunning?`, `shouldRetryOnFailure?`, `maxRetryAttempts?`                     | N/A (Python uses constructor args for `BaseTool` directly for common fields; retry fields don't exist as Python `BaseTool` doesn't have built-in retry)                                                                                                                                                                                                                                                         | `shouldRetryOnFailure?`, `maxRetryAttempts?` (specific to TS retry logic).                                                                                                                       | None (Considered Aligned)  | TS `ToolConfig` correctly supports `BaseTool.ts` features. Common fields (`name`, `description`, `isLongRunning`) align with Python's `BaseTool` constructor. Additional TS fields support TS-specific retry enhancements.                                                                                                                                                                                                                                                                                                                                                                                              |
| `src/llm/base-llm.ts`            | `adk-python/models/base_llm.py`    | `BaseLLM` / `BaseLlm`  | `model`, `constructor`, `static supportedModels`, `abstract generateContentAsync`, `connect`            | `model_config` (Pydantic), `_maybe_append_user_content` helper method.                                                                                                                                                                                                                                                                                                                                             | None major.                                                                                                                                                                                        | Minor                      | Core API is very similar. Main differences are Python's Pydantic integration and the `_maybe_append_user_content` helper in Python for request modification, which uses `google.genai.types`. Added `_maybeAppendUserContent` to TS.                                                                                                                                                                                                                                                                                                                                                                             |
| `src/models/request/llm-request.ts` | `adk-python/models/llm_request.py` | `LLMRequest` / `LlmRequest` (and `Content`/`Part` model) | `contents: Content[]` (new), `config: LLMRequestConfig`, `constructor` | Python `LlmRequest` has `model`, `live_connect_config`, `tools_dict`, `append_instructions`, `append_tools`, `set_output_schema`. Python `config` is `GenerateContentConfig` (more extensive). Python `contents` uses `google.genai.types.Content/Part`. | TS `LLMRequest` now uses `Content[]` with `Part`s (`TextPart`, `InlineDataPart`, `FunctionCallPart`, `FunctionResponsePart`) mirroring Google SDK's structure. Old `Message` based structure removed. `Role` type also updated. | Breaking (Aligned with Python Model) | **Refactored TS to use Content/Part model.** Fundamental change from previous OpenAI-style `Message[]`. Aligns data structure with Python, facilitating logic porting. `LLMRequestConfig` still simpler than Python's `GenerateContentConfig`. TODOs added in TS for further alignment (model field, methods). |
| `src/models/request/llm-request.ts` | `adk-python/models/llm_request.py` | `Message` (TS interface) | `role`, `content`, `name?`, `function_call?`, `tool_calls?`, `tool_call_id?`                             | Python equivalent is `types.Content`. Differences in how `function_call` (TS `arguments: string` vs. Py `args: dict`), `tool_calls` (TS explicit list vs. Py `Part.function_call`), and `tool_call_id` are represented.                                                                                                                                                                           | Explicit `tool_calls` (list of `ToolCall`) and `tool_call_id` are more OpenAI-like.                                                                                                              | Major                      | Corresponds to Python's `types.Content`. Significant differences in structure for function/tool calls and content parts.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| `src/models/request/llm-request.ts` | `adk-python/models/llm_request.py` | `LLMRequestConfig` (TS interface) | `temperature?`, `max_tokens?`, `top_p?`, `frequency_penalty?`, `presence_penalty?`, `functions?`          | Python's `types.GenerateContentConfig` is far more comprehensive (e.g., `safety_settings`, `tool_config`, `system_instruction`, `response_schema`, `candidate_count`, `stop_sequences`). `frequency_penalty`, `presence_penalty` are not direct Google SDK params. `functions` in TS maps to `tools` in Python's config. | Simpler, more common OpenAI-style parameters.                                                                                                                                                    | Major                      | TS config is a subset and uses different parameter names/structures (e.g. `functions` vs. `tools`) compared to Python's extensive `GenerateContentConfig`.                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `src/models/response/llm-response.ts` | `adk-python/models/llm_response.py` | `LLMResponse` / `LlmResponse` | `content?: Content` (new), `is_partial?`, `raw_response?`, `error_code?`, `error_message?`, `turn_complete?` | Python `LlmResponse` has `grounding_metadata`, `interrupted`, `custom_metadata`, and a static `create()` method. Its `content` is `Optional[types.Content]`. | TS `LLMResponse` now has `content?: Content` as its primary data field. Old fields (`content: string`, `function_call`, `tool_calls`, `role`) removed. Old `FunctionCall`/`ToolCall` interfaces in this file removed. | Breaking (Aligned with Python Model) | **Refactored TS to use Content/Part model for response.** Ensures consistency with `LLMRequest`. Model output (text, function calls) now expected within `response.content.parts`. Still simpler than Python's `LlmResponse` (fewer metadata fields, no static create method yet). |
| `src/models/response/llm-response.ts` | `adk-python/models/llm_response.py` | `FunctionCall` (TS interface) | `name`, `arguments: Record<string, any>`                                                                          | Python's `types.FunctionCall` has `args: dict`.                                                                                                                                                                                                                                                                                                                                                        | `arguments` is now `Record<string, any>`.                                                                                                                                                                      | None (Aligned)                      | Aligned: `arguments` field type changed from `string` to `Record<string, any>` to match Python's `args: dict` concept.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `src/models/response/llm-response.ts` | `adk-python/models/llm_response.py` | `ToolCall` (TS interface)     | `id`, `function: FunctionCall`                                                                       | Python's `types.Content` parts would contain `types.FunctionCall`. The `id` concept per call is more OpenAI-like and not directly in Google SDK's `FunctionCall` structure.                                                                                                                                                                                                                                | Explicit `id` for tool call.                                                                                                                                                                       | Minor to Major             | TS has a distinct `ToolCall` object. Python embeds `FunctionCall`s within `Content` parts. The `id` is an architectural difference.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| `src/llm/base-llm-connection.ts` | `adk-python/models/base_llm_connection.py` | `BaseLLMConnection` / `BaseLlmConnection` | `isActive` (getter), `abstract send(string)`, `abstract onResponse`, `abstract onError`, `abstract onEnd`, `close()` | All methods are `async`. `send_history(list[types.Content])`, `send_content(types.Content)`, `send_realtime(types.Blob)`, `receive() -> AsyncGenerator[LlmResponse, None]`, `async close()`. No `isActive` property. | Callback-based model for async operations (`onResponse`, `onError`, `onEnd`). Synchronous `send(string)`. `isActive` property. | Breaking                   | Major architectural difference: TS uses callbacks and a simple `send` for async communication. Python uses `async` methods for sending structured data (history, content, realtime blobs) and an `async for` generator pattern for receiving. Python is geared towards richer, multi-modal, structured communication.                                                                                                                                                                                                                                                                                       |
| `src/models/function-declaration.ts` | `google.genai.types.FunctionDeclaration` | `FunctionDeclaration` (TS) | `name: string`, `description: string`, `parameters: JSONSchema` | Python's `parameters` is `types.Schema`. `types.Schema.type` is an enum (`types.Type`) vs. TS `JSONSchema.type` (string).   | Relies on a custom `JSONSchema` interface. | Minor                      | Conceptually aligned. TS uses a generic `JSONSchema` interface with string types for schema properties. Python SDK uses `types.Schema` with specific enums (e.g., `types.Type`). The core structure (name, description, parameters with type/properties/items/required) is similar.                                                                                                                                                                                                                                                                                                          |
| `src/models/function-declaration.ts` | `google.genai.types.Schema` (conceptual)  | `JSONSchema` (TS)          | `type: string`, `properties?`, `items?`, `required?`, `enum?`, `description?`, various other JSON schema fields. | Python's `types.Schema.type` is an enum (`types.Type`). Specific `types.Format` enum may be used.                                                                                                                                  | `type` is `string`. Generic JSON schema representation. | Minor                      | Good representation of JSON Schema. Difference mainly in `type` being string vs. Python SDK's enum.                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
